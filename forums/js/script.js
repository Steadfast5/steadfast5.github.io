function showCreatePage(){document.body.innerHTML='<div class="top-bar"><h1>Steadfast5 Forums</h1></div><h3>New Forum</h3><br><form id="create-forum"><label for="forum-title">Forum Title</label><input type="text" id="forum-title" name="forum-title" required><br><label for="forum-content">Content</label><textarea type="text" id="forum-content" name="forum-content" required></textarea><button id="create-forum-button" type="submit"><strong>Create</strong></button><button id="back-button" type="button"><strong>Back</strong></button></form><div id="error"></div>',document.getElementById("back-button").addEventListener("click",showDefaultPage),document.getElementById("create-forum").addEventListener("submit",postForum)}async function postForum(e){if(e.preventDefault(),""!==document.getElementById("forum-title").value)if(""!==document.getElementById("forum-content").value){let e=generateId();await post(document.getElementById("forum-title").value,document.getElementById("forum-content").value,e),window.location.replace("./"+e)}else document.getElementById("error").innerHTML='<p style="color:red">Content cannot be empty.</p>';else document.getElementById("error").innerHTML='<p style="color:red">Title cannot be empty.</p>'}function showDefaultPage(){document.body.innerHTML='<div class="top-bar"><h1>Steadfast5 Forums</h1></div><div id="forum"><button id="create-button">New Forum</button><div class="main"><ol></ol></div><div id="footer" class="footer"></div></div>',document.getElementById("create-button").addEventListener("click",showCreatePage)}async function initialize(){db.get("forums").map({"-":1}).once(async(e,t)=>{if(e){await db.user(e).get("alias"),e.time,await SEA.decrypt(e.title,"forumEncryptionKey"),await SEA.decrypt(e.content,"forumEncryptionKey"),GUN.state.is(e,"content");if(forum.content){let e=`<li class="row"><a href="./${forum.id}"><h4 class="title">${forum.title}</h4><div class="bottom"><p class="timestamp">${new Date(forum.time).toLocaleString()}</p></div></a></li>`;document.querySelector("ol").insertAdjacentHTML("beforeend",e)}}})}function generateId(){let e="";for(let t=0;t<11;t++)e=e.concat("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".charAt(Math.floor(64*Math.random()+0)));return e}async function post(e,t,n){const o=await SEA.encrypt(t,"forumEncryptionKey"),r=user.get("all").set({title:e,content:o,time:(new Date).toISOString()});db.get("forums").get(n).put(r)}db.on("auth",e=>{showDefaultPage(),initialize(),document.getElementById("create-button").addEventListener("click",showCreatePage)}),document.getElementById("sign-up-switch").addEventListener("click",function(e){e.preventDefault(),document.getElementById("signin").style.display="none",document.getElementById("signup").style.display="inline",document.getElementById("error").innerHTML="",document.getElementById("username").value="",document.getElementById("password").value="",document.getElementById("confirmpassword").value=""}),document.getElementById("sign-in-switch").addEventListener("click",function(e){e.preventDefault(),document.getElementById("signin").style.display="inline",document.getElementById("signup").style.display="none",document.getElementById("error").innerHTML="",document.getElementById("signin-username").value="",document.getElementById("signin-password").value=""}),document.getElementById("signup-form").addEventListener("submit",function(e){e.preventDefault(),""!==document.getElementById("username").value?document.getElementById("password").value===document.getElementById("confirmpassword").value?user.create(document.getElementById("username").value,document.getElementById("password").value,({err:e})=>{e?document.getElementById("error").innerHTML='<p style="color:red">'+e+"</p>":(user.auth(document.getElementById("username").value,document.getElementById("password").value),document.getElementById("username").value="",document.getElementById("password").value="",document.getElementById("confirmpassword").value="")}):document.getElementById("error").innerHTML='<p style="color:red">Passwords are not matching</p>':document.getElementById("error").innerHTML='<p style="color:red">Username cannot be empty</p>'}),document.getElementById("signin-form").addEventListener("submit",function(e){e.preventDefault(),""!==document.getElementById("signin-username").value&&""!==document.getElementById("signin-password").value?user.auth(document.getElementById("signin-username").value,document.getElementById("signin-password").value,({err:e})=>{e?document.getElementById("error").innerHTML='<p style="color:red">'+e+"</p>":(document.getElementById("signin-username").value="",document.getElementById("signin-password").value="")}):document.getElementById("error").innerHTML='<p style="color:red">Username or password cannot be empty</p>'});
